<svg xmlns="http://www.w3.org/2000/svg" width="960" height="520" viewBox="0 0 960 520" role="img" aria-labelledby="title desc">
  <title id="title">score_icj_v4 Calibration Pipeline</title>
  <desc id="desc">Pipeline extracted from score_icj_v4.py showing reliability weighting, shrinkage, saturation, belief mapping, and bootstrap CI.</desc>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 Z" fill="#4b5563"/>
    </marker>
    <style>
      .bg { fill: #ffffff; }
      .title { font-family: "Segoe UI", Arial, sans-serif; font-size: 21px; font-weight: 700; fill: #111827; }
      .sub { font-family: "Segoe UI", Arial, sans-serif; font-size: 12px; fill: #4b5563; }
      .box { fill: #f9fafb; stroke: #9ca3af; stroke-width: 1.3; }
      .h { font-family: "Segoe UI", Arial, sans-serif; font-size: 13px; font-weight: 700; fill: #111827; }
      .t { font-family: "Segoe UI", Arial, sans-serif; font-size: 11px; fill: #1f2937; }
      .l { stroke: #6b7280; stroke-width: 1.7; fill: none; marker-end: url(#arrow); }
      .mono { font-family: "Consolas", "SFMono-Regular", monospace; font-size: 10px; fill: #374151; }
    </style>
  </defs>

  <rect x="0" y="0" width="960" height="520" class="bg"/>
  <text x="480" y="30" class="title" text-anchor="middle">Figure A. score_icj_v4 Computational Pipeline (Extracted)</text>
  <text x="480" y="48" class="sub" text-anchor="middle">Source: annotarium/score_icj_v4.py</text>

  <rect x="30" y="80" width="170" height="90" rx="8" class="box"/>
  <text x="44" y="102" class="h">Step 1: v3 Base</text>
  <text x="44" y="120" class="t">Read v3 scores:</text>
  <text x="44" y="136" class="t">custody, credibility,</text>
  <text x="44" y="152" class="t">corroboration, clarity, confidence</text>

  <rect x="220" y="80" width="190" height="120" rx="8" class="box"/>
  <text x="234" y="102" class="h">Step 2: Reliability Factor</text>
  <text x="234" y="120" class="mono">r = 0.20 + 0.80 * base</text>
  <text x="234" y="136" class="t">base = 0.35 grounding +</text>
  <text x="234" y="152" class="t">0.25 custody_quality +</text>
  <text x="234" y="168" class="t">0.20 eligibility_ratio +</text>
  <text x="234" y="184" class="t">0.20 anchor_coverage</text>

  <rect x="430" y="80" width="210" height="140" rx="8" class="box"/>
  <text x="444" y="102" class="h">Step 3: EB-Style Shrinkage</text>
  <text x="444" y="120" class="mono">lambda = n_eff / (n_eff + tau)</text>
  <text x="444" y="136" class="t">n_eff = 0.50*anchors +</text>
  <text x="444" y="152" class="t">0.35*eligible_sources +</text>
  <text x="444" y="168" class="t">0.15*corr_sources</text>
  <text x="444" y="186" class="t">tau: custody 2.2, cred 2.8,</text>
  <text x="444" y="202" class="t">corr 3.2, clarity/conf 1.8</text>

  <rect x="660" y="80" width="270" height="140" rx="8" class="box"/>
  <text x="674" y="102" class="h">Step 4: Quantity Saturation</text>
  <text x="674" y="120" class="mono">sat(x,k)=(1-exp(-k*x))/(1-exp(-k))</text>
  <text x="674" y="136" class="t">corroboration uses source_quantity, k=1.6</text>
  <text x="674" y="152" class="t">custody uses artifact_ids + anchor_cov, k=1.4</text>
  <text x="674" y="168" class="t">credibility gate = 0.70 quality_mean +</text>
  <text x="674" y="184" class="t">0.30 diversity</text>
  <text x="674" y="200" class="t">clarity/confidence pass through shrinkage</text>

  <rect x="220" y="280" width="300" height="120" rx="8" class="box"/>
  <text x="234" y="302" class="h">Step 5: Evidence Support + Belief</text>
  <text x="234" y="320" class="mono">evidence_weight = 0.30*custody + 0.25*cred +</text>
  <text x="234" y="336" class="mono">0.25*corr + 0.20*grounding</text>
  <text x="234" y="354" class="mono">evidence_support = evidence_weight * clarity</text>
  <text x="234" y="372" class="mono">belief = logistic(k=12, support - req)</text>

  <rect x="550" y="280" width="380" height="120" rx="8" class="box"/>
  <text x="564" y="302" class="h">Step 6: Document-Level Outputs</text>
  <text x="564" y="320" class="t">Weighted means and axis averages</text>
  <text x="564" y="336" class="t">Bootstrap 95% CI (n_iter=2500, seeded)</text>
  <text x="564" y="352" class="t">Belief weighted score and calibrated axis scores</text>
  <text x="564" y="368" class="t">Output tag: statistical_profile =</text>
  <text x="564" y="384" class="mono">reliability_shrinkage_saturation_bootstrap</text>

  <path class="l" d="M200 126 L220 126"/>
  <path class="l" d="M410 144 L430 144"/>
  <path class="l" d="M640 150 L660 150"/>
  <path class="l" d="M790 220 C790 250, 530 250, 370 280"/>
  <path class="l" d="M520 340 L550 340"/>

  <text x="30" y="488" class="sub">Interpretation: v4 is a calibration layer over v3; it does not replace variable logic, it regularizes confidence under sparse/noisy evidence.</text>
</svg>
