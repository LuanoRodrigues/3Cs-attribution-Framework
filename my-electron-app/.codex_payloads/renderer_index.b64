import { PanelLayoutRoot } from "../panels/PanelLayoutRoot";
import { ToolRegistry } from "../registry/toolRegistry";
import { WorkspaceRibbon } from "../layout/WorkspaceRibbon";
import { Sidebar } from "../layout/Sidebar";
import { TabRibbon, TabId } from "../layout/TabRibbon";
import { ScreenTab } from "../ribbon/ScreenTab";
import { RetrieveTab } from "../ribbon/RetrieveTab";
import { AnalyseRibbon } from "../layout/analyse/AnalyseRibbon";
import { loadLayout, saveLayout, clearLayout } from "../state/layout";
import { createPdfTool } from "../tools/pdf";
import { createEditorTool } from "../tools/editor";
import { createNotesTool } from "../tools/notes";
import { createTimelineTool } from "../tools/timeline";
import { createVizTool } from "../tools/viz";
import { createRetrieveTool } from "../tools/retrieve";
import { dispatchAnalyseCommand } from "../analyse/commandDispatcher";
import { AnalyseWorkspace } from "../analyse/workspace";
import { AnalyseStore } from "../analyse/store";
import type { AnalyseAction } from "../analyse/types";

const registry = new ToolRegistry();
registry.register(createPdfTool());
registry.register(createEditorTool());
registry.register(createNotesTool());
registry.register(createTimelineTool());
registry.register(createVizTool());
registry.register(createRetrieveTool());

const panelRoot = document.getElementById("panel-root") as HTMLElement;
const ribbonHeader = document.getElementById("tab-header") as HTMLElement;
const ribbonActions = document.getElementById("tab-actions") as HTMLElement;
const analyseRoot = document.getElementById("analyse-root") as HTMLElement;
const sidebarEl = document.getElementById("sidebar") as HTMLElement;

let sidebar: Sidebar;
let analyseWorkspace: AnalyseWorkspace;

const layoutRoot = new PanelLayoutRoot(panelRoot, registry, {
  onLayoutChange: (snapshot) => saveLayout(snapshot),
  onFocusChange: (_id?: string, toolType?: string) => sidebar?.setActive(toolType)
});

sidebar = new Sidebar({
  mount: sidebarEl,
  spawnTool: (toolType: string) => layoutRoot.spawnTool(toolType),
  onFocusCycle: () => layoutRoot.cycleFocus()
});

const analyseStore = new AnalyseStore();

const emitAnalyseAction = (action: AnalyseAction, payload?: Record<string, unknown>) => {
  analyseWorkspace?.route(action, payload);
  dispatchAnalyseCommand("analyse", action, payload).catch((err) => console.error(err));
};

analyseWorkspace = new AnalyseWorkspace(analyseRoot, analyseStore, {
  dispatch: emitAnalyseAction
});

analyseRoot.addEventListener("analyse-command", (event) => {
  const detail = (event as CustomEvent<{ action: AnalyseAction; payload?: Record<string, unknown> }>).detail;
  if (detail?.action) {
    emitAnalyseAction(detail.action, detail.payload as Record<string, unknown>);
  }
});

const workspaceTab = {
  id: "workspace" as TabId,
  label: "Workspace",
  render: (mount: HTMLElement) => {
    new WorkspaceRibbon({
      mount,
      spawnTool: (toolType: string) => layoutRoot.spawnTool(toolType),
      split: () => layoutRoot.spawnTool("notes"),
      cycleFocus: () => layoutRoot.cycleFocus(),
      resetLayout: () => {
        clearLayout();
        window.location.reload();
      }
    });
  }
};

const retrieveTab = {
  id: "retrieve" as TabId,
  label: "Retrieve",
  render: (mount: HTMLElement) => {
    new RetrieveTab(mount, {
      openQueryBuilder: () => layoutRoot.spawnTool("retrieve")
    });
  }
};

const screenTab = {
  id: "screen" as TabId,
  label: "Screening",
  render: (mount: HTMLElement) => {
    new ScreenTab(mount);
  }
};

const analyseTab = {
  id: "analyse" as TabId,
  label: "Analyse",
  render: (mount: HTMLElement) => {
    new AnalyseRibbon({
      mount,
      command: (_phase, action, payload) => emitAnalyseAction(action, payload)
    });
  }
};

const tabRibbon = new TabRibbon({
  header: ribbonHeader,
  actions: ribbonActions,
  tabs: [workspaceTab, retrieveTab, screenTab, analyseTab],
  onTabChange: (tabId) => {
    const showWorkspace = tabId === "workspace" || tabId === "screen" || tabId === "retrieve";
    panelRoot.style.display = showWorkspace ? "" : "none";
    analyseRoot.style.display = tabId === "analyse" ? "" : "none";
  }
});

const saved = loadLayout();
if (saved) {
  layoutRoot.load(saved);
} else {
  layoutRoot.spawnTool("editor", {});
}

window.addEventListener("keydown", (ev) => {
  if (ev.ctrlKey && ev.key.toLowerCase() === "tab") {
    ev.preventDefault();
    layoutRoot.cycleFocus();
  }
});

window.addEventListener("beforeunload", () => {
  saveLayout(layoutRoot.serialize());
});