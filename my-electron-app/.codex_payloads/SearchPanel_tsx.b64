import { command } from "../../ribbon/commandDispatcher";
import type { RetrieveProviderId, RetrieveQuery, RetrieveSort } from "../../shared/types/retrieve";

export class SearchPanel {
  readonly element: HTMLElement;
  private queryInput: HTMLInputElement;
  private yearFromInput: HTMLInputElement;
  private yearToInput: HTMLInputElement;
  private providerSelect: HTMLSelectElement;
  private sortSelect: HTMLSelectElement;
  private limitInput: HTMLInputElement;
  private results: HTMLElement;
  private changeHandlers: Array<(query: RetrieveQuery) => void> = [];

  constructor(initial?: Partial<RetrieveQuery>) {
    this.element = document.createElement("div");
    this.element.className = "tool-surface";

    const header = document.createElement("div");
    header.className = "tool-header";
    const title = document.createElement("h4");
    title.textContent = "Retrieve — Query Builder";
    header.appendChild(title);
    this.element.appendChild(header);

    const form = document.createElement("div");
    form.className = "control-row";
    form.style.flexWrap = "wrap";
    form.style.rowGap = "10px";

    this.queryInput = document.createElement("input");
    this.queryInput.type = "text";
    this.queryInput.placeholder = "Search terms or DOI";
    this.queryInput.style.minWidth = "280px";
    this.queryInput.value = initial?.query ?? "";

    this.providerSelect = document.createElement("select");
    this.providerSelect.ariaLabel = "Provider";
    this.providerSelect.style.minWidth = "160px";
    this.populateProviders(initial?.provider ?? "semantic_scholar");

    this.sortSelect = document.createElement("select");
    this.sortSelect.ariaLabel = "Sort";
    [
      { value: "relevance", label: "Relevance" },
      { value: "year", label: "Year" }
    ].forEach((opt) => {
      const option = document.createElement("option");
      option.value = opt.value;
      option.textContent = opt.label;
      this.sortSelect.appendChild(option);
    });
    this.sortSelect.value = initial?.sort ?? "relevance";

    this.yearFromInput = document.createElement("input");
    this.yearFromInput.type = "number";
    this.yearFromInput.placeholder = "Year from";
    this.yearFromInput.style.width = "110px";
    this.yearFromInput.value = initial?.year_from?.toString() ?? "";

    this.yearToInput = document.createElement("input");
    this.yearToInput.type = "number";
    this.yearToInput.placeholder = "Year to";
    this.yearToInput.style.width = "110px";
    this.yearToInput.value = initial?.year_to?.toString() ?? "";

    this.limitInput = document.createElement("input");
    this.limitInput.type = "number";
    this.limitInput.placeholder = "Limit";
    this.limitInput.style.width = "90px";
    this.limitInput.value = initial?.limit?.toString() ?? "25";

    const searchBtn = document.createElement("button");
    searchBtn.className = "ribbon-button";
    searchBtn.textContent = "Search";
    searchBtn.addEventListener("click", () => this.handleSearch());

    form.append(
      this.queryInput,
      this.providerSelect,
      this.sortSelect,
      this.yearFromInput,
      this.yearToInput,
      this.limitInput,
      searchBtn
    );

    this.results = document.createElement("div");
    this.results.className = "empty-state";
    this.results.textContent = "Results will appear here after running a search.";

    this.element.append(form, this.results);

    [
      this.queryInput,
      this.providerSelect,
      this.sortSelect,
      this.yearFromInput,
      this.yearToInput,
      this.limitInput
    ].forEach((el) => {
      el.addEventListener("change", () => this.emitChange());
      el.addEventListener("input", () => this.emitChange());
    });
  }

  getQuery(): RetrieveQuery {
    const query: RetrieveQuery = {
      query: this.queryInput.value.trim(),
      provider: this.providerSelect.value as RetrieveProviderId,
      sort: this.sortSelect.value as RetrieveSort,
      limit: this.parseNumber(this.limitInput.value),
      year_from: this.parseNumber(this.yearFromInput.value),
      year_to: this.parseNumber(this.yearToInput.value)
    };
    return query;
  }

  onChange(handler: (query: RetrieveQuery) => void): void {
    this.changeHandlers.push(handler);
  }

  private emitChange(): void {
    const snapshot = this.getQuery();
    this.changeHandlers.forEach((handler) => handler(snapshot));
  }

  private async handleSearch(): Promise<void> {
    const payload = this.getQuery();
    this.results.textContent = `Searching ${payload.provider ?? "providers"}…`;
    await command("retrieve", "fetch_from_source", payload as unknown as Record<string, unknown>);
  }

  private populateProviders(selected: RetrieveProviderId): void {
    const providers: Array<{ id: RetrieveProviderId; label: string }> = [
      { id: "semantic_scholar", label: "Semantic Scholar" },
      { id: "crossref", label: "Crossref" },
      { id: "openalex", label: "OpenAlex" },
      { id: "elsevier", label: "Elsevier" },
      { id: "wos", label: "Web of Science" },
      { id: "unpaywall", label: "Unpaywall" },
      { id: "cos", label: "COS (Merged)" }
    ];
    providers.forEach((provider) => {
      const opt = document.createElement("option");
      opt.value = provider.id;
      opt.textContent = provider.label;
      this.providerSelect.appendChild(opt);
    });
    this.providerSelect.value = selected;
  }

  private parseNumber(value: string): number | undefined {
    const parsed = parseInt(value, 10);
    return Number.isFinite(parsed) ? parsed : undefined;
  }
}