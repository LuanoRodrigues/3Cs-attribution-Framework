export type TabId = "workspace" | "retrieve" | "screen" | "analyse";

export interface TabDefinition {
  id: TabId;
  label: string;
  tooltip?: string;
  render: (actionsMount: HTMLElement) => void;
}

export interface TabRibbonOptions {
  header: HTMLElement;
  actions: HTMLElement;
  tabs: TabDefinition[];
  initialTab?: TabId;
  onTabChange?: (tabId: TabId) => void;
}

export class TabRibbon {
  private header: HTMLElement;
  private actions: HTMLElement;
  private tabs: TabDefinition[];
  private buttons: HTMLElement[] = [];
  private activeTab?: TabId;
  private onTabChange?: (tabId: TabId) => void;

  constructor(options: TabRibbonOptions) {
    this.header = options.header;
    this.actions = options.actions;
    this.tabs = options.tabs;
    this.onTabChange = options.onTabChange;
    this.renderTabs();
    this.activateTab(options.initialTab || this.tabs[0].id);
  }

  private renderTabs(): void {
    this.header.innerHTML = "";
    this.buttons = [];
    this.tabs.forEach((tab) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "tab-button";
      btn.textContent = tab.label;
      if (tab.tooltip) {
        btn.title = tab.tooltip;
      }
      btn.dataset.tabId = tab.id;
      btn.addEventListener("click", () => this.activateTab(tab.id));
      this.buttons.push(btn);
      this.header.appendChild(btn);
    });
  }

  private activateTab(tabId: TabId): void {
    if (this.activeTab === tabId) return;
    this.activeTab = tabId;
    this.actions.innerHTML = "";
    const definition = this.tabs.find((tab) => tab.id === tabId);
    if (definition) {
      definition.render(this.actions);
    }
    this.buttons.forEach((btn) => {
      const id = btn.dataset.tabId as TabId;
      btn.classList.toggle("active", id === tabId);
    });
    if (this.onTabChange) {
      this.onTabChange(tabId);
    }
  }
}