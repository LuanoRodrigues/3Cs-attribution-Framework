<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zotero Reader</title>
    <style>
      :root { color-scheme: dark; }
      body { margin: 0; font-family: "Space Grotesk", "Segoe UI", sans-serif; background: #0f1720; color: #e8f2ff; }
      .topbar { height: 42px; border-bottom: 1px solid #2a415d; display: flex; align-items: center; gap: 12px; padding: 0 10px; }
      .meta { font-size: 12px; color: #9eb4cd; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .frame { width: 100vw; height: calc(100vh - 42px); border: none; background: #101927; }
      .warn { color: #fbbf24; font-size: 12px; }
      a { color: #6ec1ff; }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="meta" id="meta">Reader</div>
      <div class="warn" id="warn"></div>
    </div>
    <iframe id="frame" class="frame" referrerpolicy="no-referrer"></iframe>
    <script>
      const params = new URLSearchParams(window.location.search);
      const rawUrl = decodeURIComponent(params.get("url") || "");
      const itemKey = decodeURIComponent(params.get("itemKey") || "");
      const page = decodeURIComponent(params.get("page") || "1");
      const meta = document.getElementById("meta");
      const warn = document.getElementById("warn");
      const frame = document.getElementById("frame");

      meta.textContent = `Reader • Item ${itemKey || "N/A"} • Page ${page}`;
      if (!rawUrl) {
        warn.textContent = "Missing reader URL";
      } else if (rawUrl.startsWith("http://") || rawUrl.startsWith("https://") || rawUrl.startsWith("file://")) {
        frame.src = rawUrl;
      } else {
        warn.innerHTML = "Unsupported URL. Use Open in External for zotero:// links.";
      }
    </script>
  </body>
</html>
